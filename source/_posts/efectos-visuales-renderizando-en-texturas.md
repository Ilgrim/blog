---
title: "Efectos visuales renderizando en texturas"
date: 2013-07-22 23:15:17
tags: 
---
<p style="text-align: justify;">He conseguido algunos avances en el motor 3d del Antares, como poder ver una cámara en un display del cockpit, bloom y environment mapping. Todo ello con la misma técnica, RTT.</p>
<p style="text-align: justify;">RTT (Render To Texture) consiste en hacer que OpenGL dibuje sobre una textura en vez de sobre la pantalla principal. Después se puede usar esa textura libremente, y se pueden conseguir muchos efectos.</p>
<p style="text-align: justify;">Por ejemplo, si representas la escena vista por una cámara del juego, la textura obtenida se puede usar al dibujar un display, de forma que tienes un circuito cerrado de televisión simulado.</p>
<p style="text-align: justify;">Pero también se pueden conseguir muchos otros efectos, por ejemplo efectos a pantalla completa tipo blur o bloom (crear un halo en las zonas más iluminadas de la pantalla). Esto se consigue representando lo que vas a ver en una textura, y luego usando esa textura en el programa shader del efecto, se genera la imagen final en pantalla. La imagen siguiente muestra un efecto de bloom (se nota el halo en los botones encendidos), aunque no está muy conseguido. Normalmente para hacer el bloom se usa una máscara de los objetos que quieres que tengan halo, pero yo la máscara la he cogido de la pantalla, escogiendo los pixels con luminosidad alta.</p>
<p style="text-align: justify;"><a href="http://yombo.org/wp-content/uploads/2013/07/1-bloom.png"><img class="aligncenter size-large wp-image-737" alt="1 bloom" src="http://yombo.org/wp-content/uploads/2013/07/1-bloom-1024x576.png" width="625" height="351" /></a></p>
<p style="text-align: justify;">Otro efecto muy chulo que se puede hacer con RTT es el <em>environment mapping</em>, o sea el emulado de reflexiones reales. Supongo que sabrás que cuando te miras en un espejo plano, éste muestra la imagen de una "cámara virtual" situada por detrás del espejo, "en el mundo del espejo", a la misma distancia que tú, y mirando hacia afuera. Pues si usamos esto con la RTT, podemos situar esa cámara virtual en el juego, detrás del espejo, y representar la escena en la textura. En un programa <em>shader </em>se usa luego esa textura para representar la superfície del espejo, teniendo en cuenta la posición del espejo, la cámara real y la textura renderizada, se consigue por ejemplo reflejos en la superfície del agua.</p>
<p style="text-align: justify;">Este efecto de reflexiones en un espejo plano se puede usar incluso para agua con olas en relieve, con lo que varía la orientación de la superfície (su vector normal). Obviamente la reflexión ya no será completamente real, pero la desviación no es mucha ya que la variación de distancia de las olas con respecto a un objeto flotando, por ejemplo, es pequeña. Y parece mentira lo bien que puede quedar.</p>
<p style="text-align: justify;">Incluso se puede extender este concepto y usarlo en objetos enteros, no sólo superfícies más o menos planas. Se hacen para esto no una, sino seis representaciones de cámaras virtuales, formando un cubo que envuelve el objeto espejo. Esto obviamente repercute en el framerate, bajando de 120 frames/s a 30 frames/s con un objeto reflectivo.</p>
<p style="text-align: justify;">En la siguiente imagen de Antares y en el vídeo se puede ver la implementación que he hecho en Antares.</p>
<p style="text-align: justify;">En esta imagen uno de los "chasis" es reflectivo y el otro no. Aunque el objeto en sí no es muy adecuado para verlo por los ángulos que tiene, se puede ver el objeto verde reflejado en el de la derecha.</p>
<p style="text-align: justify;"><a href="http://yombo.org/wp-content/uploads/2013/07/3-environmentmapping.png"><img class="aligncenter size-full wp-image-738" alt="3 environmentmapping" src="http://yombo.org/wp-content/uploads/2013/07/3-environmentmapping.png" width="950" height="690" /></a></p>
<p style="text-align: justify;">Para el vídeo he cogido un modelo de Internet del Halcón Milenario, fue cuestión de dos minutos importarlo. Quería encontrar el modelo de la nave de El vuelo del Navegante, pero no la encontré. En el cockpit de la nave, en el panel derecho, se ve la imagen de la cámara externa de la nave. Lo más bonito es cuando sales al espacio... (ponlo a pantalla completa, está en HD)</p>
<iframe src="//www.youtube.com/embed/yWN5tzg04Jw?rel=0" height="720" width="960" allowfullscreen="" frameborder="0"></iframe>

Hasta la próxima!